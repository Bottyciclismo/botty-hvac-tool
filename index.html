<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BOTTY HVAC TOOL</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f2027">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
  font-family: 'Segoe UI', sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  padding: 10px;
  color: white;
}

.container { 
  background: #0d1b2a;
  width: 95%;
  max-width: 600px;
  padding: 35px;
  border-radius: 30px;
  box-shadow: 0 25px 50px rgba(0,0,0,0.6);
  border: 3px solid #1b263b;
}

.brand {
  text-align: center;
  font-weight: bold;
  font-size: 18px;
  letter-spacing: 2px;
  margin-bottom: 10px;
  color: #4cc9f0;
}

.display {
  background: #001d3d;
  font-size: 65px;
  text-align: right;
  padding: 20px;
  border-radius: 15px;
  margin-bottom: 15px;
  box-shadow: inset 0 0 15px #000;
}

.bar-container {
  background: #1b263b;
  height: 12px;
  border-radius: 10px;
  margin-bottom: 20px;
  overflow: hidden;
}

.bar {
  height: 100%;
  width: 0%;
  background: #4cc9f0;
  transition: 0.4s;
}

canvas {
  margin-top: 20px;
}

input[type="range"] {
  margin-top: 10px;
}

label {
  font-size: 13px;
  color: #a9d6e5;
}

select, input {
  width: 100%;
  padding: 10px;
  margin: 8px 0;
  border-radius: 15px;
  border: none;
  background: #1b263b;
  color: white;
}

button {
  width: 100%;
  padding: 14px;
  border-radius: 25px;
  border: none;
  background: #4cc9f0;
  color: #001d3d;
  font-weight: bold;
  font-size: 16px;
  margin-top: 15px;
  cursor: pointer;
}

.footer {
  text-align: center;
  font-size: 11px;
  margin-top: 15px;
  color: #89c2d9;
}
</style>
</head>

<body>

<div class="container">

<div class="brand">BOTTY HVAC TOOL ❄️</div>

<div class="display" id="display">0.00 °C</div>

<div class="bar-container">
  <div class="bar" id="bar"></div>
</div>

<canvas id="grafica"></canvas>

<label>Simulación Temperatura (Modo Formación)</label>
<input type="range" id="simTemp" min="-20" max="100" value="25" step="1">

<label>Tipo de Sonda</label>
<select id="tipo">
  <option value="NTC_1000">NTC 1K</option>
  <option value="NTC_10000">NTC 10K</option>
  <option value="NTC_25000">NTC 25K</option>
  <option value="PTC_1000">PTC 1K</option>
  <option value="PTC_10000">PTC 10K</option>
  <option value="PTC_25000">PTC 25K</option>
</select>

<label>Resistencia medida (Ω)</label>
<input type="number" id="resistencia" placeholder="Ej: 589">

<label>Beta (solo NTC - default 3435)</label>
<input type="number" id="beta" value="3435">

<button onclick="calcular()">MEDIR</button>

<div id="sugerencia" style="margin-top:10px; font-size:12px; color:#ffd166;"></div>

<div class="footer">
Modo Secador Frigorífico • Azul <2°C • Verde 2-45°C • Rojo >45°C
</div>

</div>

<script>

let chart;

function calcNTC(R, R0, beta){
    let T0 = 298.15;
    let tempK = 1 / ((1/T0) + (1/beta) * Math.log(R/R0));
    return tempK - 273.15;
}

function calcPTC(R, R0){
    let alpha = 0.00385;
    return (R - R0) / (R0 * alpha);
}

function generarGrafica(tipo, beta, tempActual){

    let R0 = parseInt(tipo.split("_")[1]);
    let temps = [];
    let resistencias = [];

    for(let t = -20; t <= 100; t++){
        let R;
        if(tipo.includes("NTC")){
            let T0 = 298.15;
            let Tk = t + 273.15;
            R = R0 * Math.exp(beta * (1/Tk - 1/T0));
        } else {
            let alpha = 0.00385;
            R = R0 * (1 + alpha * t);
        }
        temps.push(t);
        resistencias.push(R);
    }

    let Rmedicion;
    if(tipo.includes("NTC")){
        let T0 = 298.15;
        let Tk = tempActual + 273.15;
        Rmedicion = R0 * Math.exp(beta * (1/Tk - 1/T0));
    } else {
        let alpha = 0.00385;
        Rmedicion = R0 * (1 + alpha * tempActual);
    }

    if(chart) chart.destroy();

    chart = new Chart(document.getElementById('grafica'), {
        type: 'line',
        data: {
            datasets: [
                {
                    label: 'Curva de la sonda',
                    data: temps.map((t,i)=>({x:t,y:resistencias[i]})),
                    borderColor: '#4cc9f0',
                    borderWidth: 2,
                    fill: false,
                    parsing:false
                },
                {
                    label: 'Medición actual',
                    data: [{x: tempActual, y: Rmedicion}],
                    backgroundColor: '#ff6b6b',
                    borderColor: '#ff6b6b',
                    pointRadius: 6,
                    showLine:false,
                    parsing:false
                }
            ]
        },
        options: {
            responsive:true,
            plugins:{ legend:{ labels:{ color:"white" } } },
            scales:{
                x:{
                    type:'linear',
                    min:-20,
                    max:100,
                    ticks:{ color:"white" },
                    title:{ display:true, text:'Temperatura (°C)', color:"white" },
                    grid:{ color:(ctx)=>{
                        let v=ctx.tick.value;
                        if(v<2) return "rgba(0,180,216,0.2)";
                        if(v<=45) return "rgba(76,201,240,0.15)";
                        return "rgba(255,107,107,0.2)";
                    }}
                },
                y:{
                    ticks:{ color:"white" },
                    title:{ display:true, text:'Resistencia (Ω)', color:"white" }
                }
            }
        }
    });
}

function actualizarDisplay(tempC){
    let display=document.getElementById("display");
    let bar=document.getElementById("bar");

    display.innerHTML=tempC.toFixed(2)+" °C";

    let porcentaje=((tempC+20)/120)*100;
    porcentaje=Math.max(0,Math.min(100,porcentaje));
    bar.style.width=porcentaje+"%";

    if(tempC<2){ bar.style.background="#00b4d8"; }
    else if(tempC<=45){ bar.style.background="#4cc9f0"; }
    else{ bar.style.background="#ff6b6b"; }
}

document.getElementById("simTemp").addEventListener("input",function(){
    let tipo=document.getElementById("tipo").value;
    let beta=parseFloat(document.getElementById("beta").value);
    let t=parseFloat(this.value);
    actualizarDisplay(t);
    generarGrafica(tipo,beta,t);
});

function calcular(){

    let tipoSeleccionado = document.getElementById("tipo");
    let R = parseFloat(document.getElementById("resistencia").value);
    let beta = parseFloat(document.getElementById("beta").value);

    if(!R || R <= 0) return;

    let opciones = ["NTC_1000","NTC_10000","NTC_25000"];

    let mejorOpcion = null;
    let mejorTemp = null;
    let menorDiferencia = Infinity;

    for(let opcion of opciones){

        let R0 = parseInt(opcion.split("_")[1]);
        let temp = calcNTC(R,R0,beta);

        if(temp > -40 && temp < 120){

            // Comparamos con temperatura ambiente típica 25°C
            let diferencia = Math.abs(temp - 25);

            if(diferencia < menorDiferencia){
                menorDiferencia = diferencia;
                mejorOpcion = opcion;
                mejorTemp = temp;
            }
        }
    }

    // Si encontramos opción lógica
    if(mejorOpcion){
        tipoSeleccionado.value = mejorOpcion;
        actualizarDisplay(mejorTemp);
        generarGrafica(mejorOpcion,beta,mejorTemp);
    }
}


</script>

</body>
</html>




